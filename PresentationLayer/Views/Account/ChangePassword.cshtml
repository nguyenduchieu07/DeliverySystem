@model ChangePasswordViewModel
@{
    ViewData["Title"] = "Đổi mật khẩu - VCN Vietnam";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Styles {
    @* File CSS cần được đặt trong section Styles để đưa lên thẻ <head> *@
    <link rel="stylesheet" href="~/css/vcn-auth.css" asp-append-version="true" />
}

<div class="change-password-page">
    <div class="background-illustration">
        <div class="vehicle car1" style="--rotation: -15deg;"></div>
        <div class="vehicle van1" style="--rotation: -10deg;"></div>
        <div class="vehicle truck1" style="--rotation: -20deg;"></div>
    </div>

    <div class="change-password-container">
        <div class="change-password-logo">
            <div class="change-password-logo-text">
                <div class="change-password-logo-icon"></div>
                LALAMOVE
            </div>
        </div>

        <h2 class="change-password-title">Đổi mật khẩu</h2>
        <p class="change-password-subtitle">
            Vui lòng nhập mật khẩu hiện tại và mật khẩu mới của bạn
        </p>

        @if (!string.IsNullOrEmpty(ViewBag.Success))
        {
            <div class="alert alert-success">
                <strong>✓</strong> @ViewBag.Success
            </div>
        }

        @* Hiển thị lỗi từ server một cách tổng quát hơn *@
        <div asp-validation-summary="ModelOnly" class="alert alert-danger"></div>

        <div class="password-requirements">
            <strong>Yêu cầu mật khẩu:</strong>
            <ul>
                <li>Tối thiểu 6 ký tự</li>
                <li>Nên bao gồm chữ hoa, chữ thường và số</li>
                <li>Không được trùng với mật khẩu cũ</li>
            </ul>
        </div>

        <form asp-action="ChangePassword" method="post" id="changePasswordForm">
            <div class="form-group">
                <label asp-for="CurrentPassword" class="form-label">Mật khẩu hiện tại</label>
                <div class="password-field">
                    <input asp-for="CurrentPassword"
                           type="password"
                           class="form-control"
                           id="currentPassword"
                           placeholder="Nhập mật khẩu hiện tại" />
                    <button type="button"
                            class="password-toggle-btn"
                            onclick="togglePasswordVisibility('currentPassword', this)">
                        👁
                    </button>
                </div>
                <span asp-validation-for="CurrentPassword" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label asp-for="NewPassword" class="form-label">Mật khẩu mới</label>
                <div class="password-field">
                    <input asp-for="NewPassword"
                           type="password"
                           class="form-control"
                           id="newPassword"
                           placeholder="Nhập mật khẩu mới (tối thiểu 6 ký tự)" />
                    <button type="button"
                            class="password-toggle-btn"
                            onclick="togglePasswordVisibility('newPassword', this)">
                        👁
                    </button>
                </div>
                <span asp-validation-for="NewPassword" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label asp-for="ConfirmPassword" class="form-label">Xác nhận mật khẩu mới</label>
                <div class="password-field">
                    <input asp-for="ConfirmPassword"
                           type="password"
                           class="form-control"
                           id="confirmPassword"
                           placeholder="Nhập lại mật khẩu mới" />
                    <button type="button"
                            class="password-toggle-btn"
                            onclick="togglePasswordVisibility('confirmPassword', this)">
                        👁
                    </button>
                </div>
                <span asp-validation-for="ConfirmPassword" class="text-danger"></span>
            </div>

            <button type="submit" class="btn-primary" id="submitBtn">
                Đổi mật khẩu
            </button>
        </form>

        <div class="back-link">
            @* Lưu ý: area = "Account" có thể không đúng, hãy kiểm tra lại routing của bạn *@
            <a href="@Url.Action("Profile", "Account")">
                ← Quay lại trang cá nhân
            </a>
        </div>
    </div>
</div>

@section Scripts {
    @* Gộp tất cả script vào một section duy nhất *@
    <partial name="_ValidationScriptsPartial" />
    <script src="~/js/vcn-auth.js" asp-append-version="true"></script>

    <script>
        function togglePasswordVisibility(inputId, button) {
            const passwordInput = document.getElementById(inputId);

            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                button.textContent = '🙈';
            } else {
                passwordInput.type = 'password';
                button.textContent = '👁';
            }
        }

        const form = document.getElementById('changePasswordForm');
        if (form) {
            form.addEventListener('submit', function (e) {
                // Chỉ chạy khi form đã hợp lệ theo validation của ASP.NET
                if (form.checkValidity()) {
                    const submitBtn = document.getElementById('submitBtn');
                    submitBtn.textContent = 'Đang xử lý...';
                    submitBtn.disabled = true;
                }
            });
        }
    </script>

}
