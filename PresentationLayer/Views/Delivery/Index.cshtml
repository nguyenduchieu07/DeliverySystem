
@{
    ViewData["Title"] = "Đặt dịch vụ kho";
}

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />

<!-- Custom CSS -->
<link rel="stylesheet" href="~/css/vcn-auth.css" />

<div class="delivery-page">
    <!-- Left Sidebar - Order Form (60%) -->
    <div class="delivery-sidebar">
        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <a href="#" class="nav-tab active">Dịch vụ kho</a>
            <a href="@Url.Action("Orders", "Delivery")" class="nav-tab">Đơn hàng</a>
            <a href="@Url.Action("Wallet", "Account")" class="nav-tab">Thanh toán</a>
        </div>

        <!-- Delivery Form -->
        <div class="delivery-form">
            @using (Html.BeginForm("BookDelivery", "Delivery", FormMethod.Post, new { id = "deliveryForm" }))
            {
                @Html.AntiForgeryToken()

                <!-- Date Selection -->
                <div class="date-section">
                    <div class="section-title" style="margin-bottom: 15px;">Thời gian</div>
                    <div class="date-row">
                        <div class="date-group">
                            <label class="date-label">Ngày vận chuyển<span class="required">*</span></label>
                            <input type="date" class="date-input" id="deliveryDate" name="DeliveryDate" required>
                        </div>
                        <div class="date-group">
                            <label class="date-label">Ngày lấy đồ<span class="required">*</span></label>
                            <input type="date" class="date-input" id="pickupDate" name="PickupDate" required>
                        </div>
                    </div>
                </div>

                <!-- Customer Info -->
                <div class="customer-info-section">
                    <div class="section-title">Thông tin khách hàng <span class="required">*</span></div>
                    <div class="customer-info-display" id="customerInfoDisplay" onclick="showPickupInfoPopup()">
                        <div class="customer-info-placeholder" id="customerInfoPlaceholder">
                            <span class="placeholder-icon">👤</span>
                            <span class="placeholder-text">Nhấn để nhập thông tin khách hàng</span>
                        </div>
                        <div class="customer-info-content" id="customerInfoContent" style="display: none;">
                            <div class="customer-name" id="customerName"></div>
                            <div class="customer-phone" id="customerPhone"></div>
                            <div class="customer-floor" id="customerFloor"></div>
                        </div>
                    </div>
                </div>

                <!-- Pickup Address -->
                <div class="location-section">
                    <div class="section-title">Địa chỉ lấy hàng <span class="required">*</span></div>
                    <div class="address-input-wrapper">
                        <input type="text"
                               class="address-autocomplete"
                               id="pickupAddressInput"
                               placeholder="Nhập địa chỉ lấy hàng (vd: Dương Quảng Hàm...)"
                               autocomplete="off">
                        <div class="autocomplete-results" id="pickupAutocompleteResults"></div>
                    </div>
                    <div class="selected-address-display" id="selectedPickupAddress"></div>
                    @Html.Hidden("PickupAddressData", "", new { @id = "pickupAddressData" })
                </div>

                <!-- Dropoff Address -->
                <div class="location-section">
                    <div class="section-title">Khu vực tìm kho <span class="required">*</span></div>
                    <div class="address-input-wrapper">
                        <input type="text"
                               class="address-autocomplete"
                               id="dropoffAddressInput"
                               placeholder="Nhập khu vực muốn tìm kho gần đó..."
                               autocomplete="off">
                        <div class="autocomplete-results" id="dropoffAutocompleteResults"></div>
                    </div>
                    <div class="selected-address-display" id="selectedDropoffAddress"></div>
                    @Html.Hidden("DropoffAddressData", "", new { @id = "dropoffAddressData" })
                </div>

                <!-- Items List -->
                <div class="items-section">
                    <div class="section-title">Danh sách đồ dùng (tùy chọn)</div>
                    <div class="items-list" id="itemsList">
                        <div class="item-row">
                            <input type="text" class="item-input item-input-name" placeholder="Tên đồ dùng" name="Items[0].Name">
                            <input type="number" class="item-input item-input-quantity" placeholder="Số lượng" name="Items[0].Quantity" min="1">
                            <button type="button" class="btn-icon btn-add" onclick="addItemRow()">+</button>
                        </div>
                    </div>
                </div>

                <!-- Product Category -->
                <div class="goods-info-section">
                    <div class="section-title">Loại hàng hóa <span class="required">*</span></div>
                    <button type="button" class="goods-info-btn" id="productCategoryBtn" onclick="showProductCategoryPopup()">
                        <span id="selectedProductText">Chọn loại hàng hóa</span>
                        <span>▼</span>
                    </button>
                    @Html.Hidden("ProductCategory", "", new { @id = "productCategory" })
                </div>

                <!-- Estimated Weight -->
                <div class="weight-section">
                    <div class="section-title">Trọng lượng ước tính <span class="required">*</span></div>
                    <div class="weight-input-group">
                        <input type="number"
                               class="weight-input"
                               id="estimatedWeight"
                               name="EstimatedWeight"
                               placeholder="Nhập trọng lượng..."
                               min="0.1"
                               step="0.1"
                               oninput="handleWeightInput()"
                               required>
                        <span class="weight-unit">kg</span>
                    </div>
                </div>

                <!-- Vehicle Suggestions -->
                <div class="vehicle-suggestions" id="vehicleSuggestions">
                    <div class="suggestions-title">Phương tiện phù hợp:</div>
                    <div class="vehicle-options">
                        <div class="vehicle-option" data-vehicle="motorbike" data-max-weight="30" onclick="selectVehicle(this, 'motorbike')">
                            <div class="vehicle-icon-wrapper">🏍️</div>
                            <div class="vehicle-info">
                                <div class="vehicle-name">Xe Máy</div>
                                <div class="vehicle-capacity">≤ 30kg</div>
                            </div>
                        </div>
                        <div class="vehicle-option" data-vehicle="van500" data-max-weight="500" onclick="selectVehicle(this, 'van500')">
                            <div class="vehicle-icon-wrapper">🚐</div>
                            <div class="vehicle-info">
                                <div class="vehicle-name">Xe Van 500kg</div>
                                <div class="vehicle-capacity">≤ 500kg</div>
                            </div>
                        </div>
                        <div class="vehicle-option" data-vehicle="van750" data-max-weight="750" onclick="selectVehicle(this, 'van750')">
                            <div class="vehicle-icon-wrapper">🚐</div>
                            <div class="vehicle-info">
                                <div class="vehicle-name">Xe Van 750kg</div>
                                <div class="vehicle-capacity">≤ 750kg</div>
                            </div>
                        </div>
                        <div class="vehicle-option" data-vehicle="van1000" data-max-weight="1000" onclick="selectVehicle(this, 'van1000')">
                            <div class="vehicle-icon-wrapper">🚚</div>
                            <div class="vehicle-info">
                                <div class="vehicle-name">Xe Van 1000kg</div>
                                <div class="vehicle-capacity">≤ 1000kg</div>
                            </div>
                        </div>
                        <div class="vehicle-option" data-vehicle="pickup" data-max-weight="800" onclick="selectVehicle(this, 'pickup')">
                            <div class="vehicle-icon-wrapper">🛻</div>
                            <div class="vehicle-info">
                                <div class="vehicle-name">Xe Bán Tải</div>
                                <div class="vehicle-capacity">≤ 800kg</div>
                            </div>
                        </div>
                        <div class="vehicle-option" data-vehicle="truck1500" data-max-weight="1500" onclick="selectVehicle(this, 'truck1500')">
                            <div class="vehicle-icon-wrapper">🚛</div>
                            <div class="vehicle-info">
                                <div class="vehicle-name">Xe Tải 1.5 Tấn</div>
                                <div class="vehicle-capacity">≤ 1500kg</div>
                            </div>
                        </div>
                        <div class="vehicle-option" data-vehicle="truck2500" data-max-weight="2500" onclick="selectVehicle(this, 'truck2500')">
                            <div class="vehicle-icon-wrapper">🚛</div>
                            <div class="vehicle-info">
                                <div class="vehicle-name">Xe Tải 2.5 Tấn</div>
                                <div class="vehicle-capacity">≤ 2500kg</div>
                            </div>
                        </div>
                        <div class="vehicle-option" data-vehicle="truck3500" data-max-weight="3500" onclick="selectVehicle(this, 'truck3500')">
                            <div class="vehicle-icon-wrapper">🚛</div>
                            <div class="vehicle-info">
                                <div class="vehicle-name">Xe Tải 3.5 Tấn</div>
                                <div class="vehicle-capacity">≤ 3500kg</div>
                            </div>
                        </div>
                    </div>
                    @Html.Hidden("SelectedVehicle", "", new { @id = "selectedVehicle" })
                </div>

                <!-- Note Section -->
                <div class="note-section">
                    <div class="section-title">Ghi chú (tùy chọn)</div>
                    @Html.TextArea("Note", "", new
                        {
                            @class = "note-textarea",
                            @placeholder = "Nhập ghi chú về hàng hóa, yêu cầu đặc biệt...",
                            @id = "orderNote"
                        })
                </div>
            }
        </div>

        <!-- Book Button -->
        <div class="book-section">
            <button type="button" class="book-btn" onclick="submitOrder()" id="bookBtn">
                Yêu cầu báo giá từ các kho
            </button>
        </div>
    </div>

    <!-- Map Container (40%) -->
    <div class="map-container">
        <div id="map" style="width: 100%; height: 100%;"></div>
    </div>
</div>

<!-- Pickup Info Popup -->
<div class="popup-overlay" id="popupOverlay"></div>

<div class="pickup-info-popup" id="pickupInfoPopup">
    <div class="popup-header">
        <h3 class="popup-title">Thông tin người gửi</h3>
        <button type="button" class="popup-close" onclick="hidePickupInfoPopup()">×</button>
    </div>
    <div class="form-group">
        <label class="form-label">Tên người gửi <span class="required">*</span></label>
        <input type="text" class="form-input" id="pickupName" placeholder="Nhập tên...">
    </div>
    <div class="form-group">
        <label class="form-label">Số điện thoại <span class="required">*</span></label>
        <input type="tel" class="form-input" id="pickupPhone" placeholder="Nhập số điện thoại...">
    </div>
    <div class="form-group">
        <label class="form-label">Phòng/Lô/Tầng</label>
        <input type="text" class="form-input" id="pickupFloor" placeholder="Ví dụ: Tầng 3, Phòng 3011">
    </div>
    <div class="popup-buttons">
        <button type="button" class="popup-btn popup-btn-cancel" onclick="hidePickupInfoPopup()">Hủy</button>
        <button type="button" class="popup-btn popup-btn-save" onclick="savePickupInfo()">Lưu</button>
    </div>
</div>

<!-- Product Category Popup -->
<div class="pickup-info-popup" id="productCategoryPopup">
    <div class="popup-header">
        <h3 class="popup-title">Chọn loại hàng hóa</h3>
        <button type="button" class="popup-close" onclick="hideProductCategoryPopup()">×</button>
    </div>
    <div class="autocomplete-results show" id="productCategoryList" style="position: static; margin: 0; border: none; box-shadow: none; max-height: 400px;">
        <!-- Product categories will be loaded here -->
    </div>
</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>

<!-- Custom JS -->
<script src="~/js/vcn-auth.js"></script>
```