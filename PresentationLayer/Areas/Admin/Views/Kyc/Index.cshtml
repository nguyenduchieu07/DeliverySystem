
@using DataAccessLayer.Entities
@model IEnumerable<KycSubmission>
@{
    ViewBag.Title = "KYC chờ duyệt";
}
<style>
    .alert {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        padding: 10px 12px;
        border-radius: 10px;
        margin: 10px 0;
        border: 1px solid transparent;
        font-size: 14px;
    }

        .alert.success {
            background: rgba(34,197,94,.12); /* xanh lá nhạt */
            border-color: rgba(34,197,94,.35);
            color: rgb(187, 247, 208);
        }

        .alert.error {
            background: rgba(239,68,68,.12); /* đỏ nhạt */
            border-color: rgba(239,68,68,.35);
            color: rgb(254, 202, 202);
        }

        .alert .close {
            border: none;
            background: transparent;
            color: inherit;
            font-size: 18px;
            line-height: 1;
            cursor: pointer;
            padding: 0 4px;
        }

    select {
        color: rgb(230, 233, 242); /* To match the input's text color */
        background-color: rgb(12, 19, 33); /* To match the input's background color */
        border-radius: 10px; /* To match the input's rounded corners */
        /* Keep the previously applied styles for width, height, padding, border, and box-sizing */
        width: 191px;
        height: 33px;
        padding: 8px 10px;
        border: 1px solid rgb(31, 42, 62);
        box-sizing: border-box;
    }
</style>
<div class="tabs">
    <div class="tab active" data-tab="kyc">KYC</div>
    <div class="tab" data-tab="feedback">Feedback</div>
    <div class="tab" data-tab="ban">Ban</div>
</div>
@if (TempData["Success"] is string ok && !string.IsNullOrWhiteSpace(ok))
{
    <div class="alert success">
        <span class="msg">@ok</span>
        <button type="button" class="close" aria-label="Đóng" onclick="this.parentElement.remove()">×</button>
    </div>
}
@if (TempData["Error"] is string err && !string.IsNullOrWhiteSpace(err))
{
    <div class="alert error">
        <span class="msg">@err</span>
        <button type="button" class="close" aria-label="Đóng" onclick="this.parentElement.remove()">×</button>
    </div>
}

<section class="grid panel" id="panel-kyc">
    <div class="card col-12">
        <div class="head">
            <h3>KYC chờ duyệt</h3>
            <form method="get" class="filters">
                <select name="status" value="@Context.Request.Query["status"]">
                    <option value="Pending">Pending</option>
                    <option value="NeedChanges">Need Changes</option>
                    <option value="Approved">Approved</option>
                    <option value="Rejected">Rejected</option>
                </select>
                <input class="input" name="q" placeholder="Tìm theo tên cửa hàng" value="@Context.Request.Query["q"]" />
                <button class="btn">Lọc</button>
            </form>
        </div>
        <div class="body">
            <table class="table kyc-table" style="width:80vw">

                <thead>
                    <tr>
                        <th>Cửa hàng</th>
                        <th>Ngày nộp</th>
                        <th>Giấy tờ</th>
                        <th>Trạng thái</th>
                        <th>Max/Day</th>
                        <th>Hành động</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var s in Model)
                    {
                        <tr>
                            <td><b>@s.Store.StoreName</b> · @s.Store.Id.ToString().Substring(0, 4)</td>
                            <td>@s.SubmittedAt.ToLocalTime()</td>
                            <td>
                                @foreach (var d in s.Documents)
                                {
                                    <a href="@d.FilePath" target="_blank">@d.DocType</a>

                                    @:
                                }
                            </td>
                            <td><span class="chip @(s.Status==DataAccessLayer.Enums.KycStatus.Approved?"ok":s.Status==DataAccessLayer.Enums.KycStatus.Rejected ?"danger":"pending")">@s.Status</span></td>
                            <td>
                                <form asp-area="Admin" asp-controller="Kyc" asp-action="Approve" method="post" class="inline">
                                    <input type="hidden" name="submissionId" value="@s.Id" />
                                    <input class="input sm" name="maxPerDay" type="number" placeholder="Max/day" style="width:90px" />
                                    <input class="input sm" name="regionsCsv" placeholder="HN,HCM,DN" style="width:140px" />
                                    <button class="btn success">Approve</button>
                                </form>
                            </td>
                            <td class="actions">
                                <div class="cell">
                                    <form asp-area="Admin" asp-controller="Kyc" asp-action="NeedChanges" method="post" class="inline">
                                        <input type="hidden" name="submissionId" value="@s.Id" />
                                        <input class="input sm" name="note" placeholder="Thiếu giấy tờ..." />
                                        <button class="btn warn">Need changes</button>
                                    </form>

                                    <form asp-area="Admin" asp-controller="Kyc" asp-action="Reject" method="post" class="inline">
                                        <input type="hidden" name="submissionId" value="@s.Id" />
                                        <input class="input sm" name="note" placeholder="Lý do từ chối..." />
                                        <button class="btn danger">Reject</button>
                                    </form>
                                </div>
                            </td>

                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</section>
@section Scripts {
    <script>
        setTimeout(() => {
            document.querySelectorAll('.alert').forEach(a => a.remove());
        }, 4000);
    </script>

}
